#:set font_size_height_factor 0.7
#:set font_size_width_factor 0.09
#:set tmp_dir './tmp/'

<MenuScreen>:
    FloatLayout:
        GridLayout:
            size_hint: (1, 0.95)
            pos_hint: {'left': 0, 'top': 1}
            rows: 2
            padding: (20, 20, 20, 10)
            spacing: 50
            Image:
                source: 'assets/logo.png'
            GridLayout:
                size_hint_y: 0.5
                rows: 2
                padding: (50, 0)
                spacing: 30
                GridLayout:
                    cols: 3
                    spacing: 30
                    Button:
                        text: 'Gather input images'
                        font_size: self.width * font_size_width_factor
                        halign: 'center'
                        on_press: root.manager.current = 'gather_screen'
                    Button:
                        text: 'Calculate normal map'
                        font_size: self.width * font_size_width_factor
                        halign: 'center'
                        on_press: root.manager.current = 'calculate_screen'
                    Button:
                        text: 'Change workspace'
                        font_size: self.width * font_size_width_factor
                        halign: 'center'
                        on_press: root.show_change_workspace_menu()
                Button:
                    text: 'Quit'
                    font_size: self.height * font_size_height_factor
                    size_hint_y: 0.3
                    on_press: app.stop()
        WorkspaceWidget:
            id: workspace_id
            size_hint: (1, 0.05)
            pos_hint: {'left': 0.0, 'bottom': 0.0}

<WorkspaceWidget>:
    FloatLayout:
        id: workspace_layout
        canvas:
            Color:
                rgba: 0.2, 0.2, 0.2, 1
            Rectangle:
                pos: self.pos
                size: self.size
        Label:
            id: workspace_path_label
            size_hint: (1, 1)
            pos_hint: {'left': 0.3, 'bottom': 0.2}
            font_size: self.height * font_size_height_factor
            text_size: self.size
            text: "Workspace path: " + root.workspace_path_property
            halign: 'left'
            valign: 'middle'

<ChooseWorkspaceDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
        BoxLayout:
            size_hint_y: None
            height: 30
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Change"
                on_release: root.change_workspace(filechooser.path)

<GatherScreen>:
    FloatLayout:
        FloatLayout:
            size_hint: (1, 0.95)
            pos_hint: {'left': 0, 'top': 1}
            Label:
                text: 'Gather all input images'
                size_hint: 0.5, 0.11
                font_size: self.height
                halign: 'center'
                valign: 'middle'
                pos_hint: {'center_x': 0.5, 'center_y': 0.9}
            Button:
                text: 'Back to menu'
                size_hint: (0.3, 0.05)
                pos_hint: {'center_x': 0.15, 'center_y': 0.05}
                font_size: self.height * font_size_height_factor
                on_press: root.manager.current = 'menu_screen'
            Button:
                text: 'Check camera'
                size_hint: (0.3, 0.05)
                pos_hint: {'center_x': 0.5, 'center_y': 0.05}
                font_size: self.height * font_size_height_factor
                on_release: root.check_camera()
            Button:
                text: 'Capture all images'
                size_hint: (0.3, 0.05)
                pos_hint: {'center_x': 0.85, 'center_y': 0.05}
                font_size: self.height * font_size_height_factor
                on_press: root.capture_all_assets()
            BoxLayout:
                pos_hint: {'center_x': 0.325, 'center_y': 0.45}
                size_hint: (0.647, 0.7)
                padding: 2
                canvas:
                    Color:
                        rgba: 1, 1, 1, 1
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height
                Image:
                    id: check_image
                    allow_stretch: True
                    keep_ratio: True
                    source: tmp_dir + 'tmp.png'
            GridLayout:
                rows:1
                cols:4
                pos_hint: {'center_x': 0.85, 'center_y': 0.45}
                halign: 'left'
                size_hint: (0.3, 0.06)
                Label:
                    text: 'Resolution:'
                    size_hint: (0.5, 1)
                    font_size: self.width * font_size_width_factor * 2
                TextInput:
                    id: resolutionWidthTextInput
                    text: '3280'
                    valign: 'middle'
                    font_size: self.width * 0.39
                    size_hint: (0.2, 1)
                    multiline: False
                    on_text_validate: root.setResolution()
                Label:
                    text: 'x'
                    size_hint: (0.1, 1)
                    font_size: self.width * 0.8
                TextInput:
                    id: resolutionHeightTextInput
                    text: '2464'
                    valign: 'middle'
                    font_size: self.width * 0.39
                    size_hint: (0.2, 1)
                    multiline: False
                    on_text_validate: root.setResolution()
        WorkspaceWidget:
            id: workspace_id
            size_hint: (1, 0.05)
            pos_hint: {'left': 0.0, 'bottom': 0.0}

<CalculateScreen>:
    on_pre_enter: root.reload_current_assets_path()
    FloatLayout:
        id: calculate_layout
        FloatLayout:
            size_hint: (1, 0.95)
            pos_hint: {'left': 0, 'top': 1}
            Label:
                text: 'Calculate normal map'
                size_hint: 0.5, 0.11
                pos_hint: {'center_x': 0.5, 'center_y': 0.9}
                font_size: self.height
                halign: 'center'
                valign: 'middle'
            Image:
                id: normal_map_image
                size_hint_y: 0.7
                pos_hint: {'center_x': 0.5, 'center_y': 0.47}
                allow_stretch: True
                keep_ratio: True
                source: 'assets/preview.jpg'
            Label:
                id: progress_label
                text: '0%'
                size_hint: 0.05, 0.03
                pos_hint: {'right': 0.073, 'center_y': 0.1}
                font_size: self.height
                halign: 'center'
                valign: 'middle'
            ProgressBar:
                id: progress_bar
                size_hint: 0.9, 0.01
                pos_hint: {'center_x': 0.54, 'center_y': 0.1}
                min: 0
                max: 100
                value: 0
            Button:
                size_hint: (0.3, 0.05)
                pos_hint: {'center_x': 0.85, 'center_y': 0.05}
                text: 'Calculate normal map'
                font_size: self.height * font_size_height_factor
                on_press: root.calculate_normal_map()
            GridLayout:
                cols: 2
                rows: 1
                size_hint: (0.38, 0.05)
                pos_hint: {'center_x': 0.5, 'center_y': 0.05}
                Label:
                    size_hint: (0.3, 0.05)
                    pos_hint: {'left': 0.1, 'bottom': 0}
                    text: 'Assets path: '
                    font_size: self.width * 0.15
                    halign: 'left'
                    valign: 'middle'
                Spinner:
                    id: spinner_id
                    size_hint: (0.7, 0.05)
                    pos_hint: {'right': 1, 'bottom': 0}
                    font_size: self.width * 0.05
                    text: "Click to choose assets path"
                    on_text: root.spinner_clicked(spinner_id.text)
            Button:
                size_hint: (0.3, 0.05)
                pos_hint: {'center_x': 0.15, 'center_y': 0.05}
                text: 'Back to menu'
                font_size: self.height * font_size_height_factor
                on_press: root.exit()
        WorkspaceWidget:
            id: workspace_id
            size_hint: (1, 0.05)
            pos_hint: {'left': 0.0, 'bottom': 0.0}
